<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cart — SS Store</title>

    <link rel="stylesheet" href="cart.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="cart-header">
        <a class="brand" href="#">
          <img
            src="https://res.cloudinary.com/dilr4t8mt/image/upload/v1763378718/Untitled_design_2_wyxpvf.png"
            alt="SS Store"
          />
          <h1>SS Store</h1>
        </a>
        <nav>
          <a class="meta-link" href="../index.html">Continue shopping →</a>
        </nav>
      </header>

      <!-- Main layout -->
      <main class="layout">
        <!-- Cart items -->
        <section class="cart-items">
          <div class="panel">
            <div class="cart-title">
              <h2>Shopping cart</h2>
              <div class="cart-count">No item</div>
            </div>
            <div class="cart-products"></div>
            <!-- Promo / note -->
            <div class="small" style="margin-top: 8px">
              Promo: Get free shipping on orders over $99.
            </div>
          </div>
        </section>

        <!-- Order summary -->
        <aside class="summary">
          <div class="panel">
            <h3>Order summary</h3>

            <div class="summary-row">
              <div>Subtotal</div>
              <div class="sub-total">₹196.00</div>
            </div>
            <div class="summary-row">
              <div>Estimated shipping</div>
              <div class="shipping">$0.00</div>
            </div>
            <div class="summary-row">
              <div>Tax</div>
              <div class="tax">$0.00</div>
            </div>

            <div class="summary-total">
              <div>Total</div>
              <div class="total">$0.00</div>
            </div>

            <div style="margin-top: 8px">
              <label
                for="coupon"
                class="small"
                style="display: block; margin-bottom: 6px; color: var(--muted)"
                >Have a coupon?</label
              >
              <div class="coupon">
                <input id="coupon" placeholder="Promo code" />
                <button type="button" class="promo-code">Apply</button>
              </div>
            </div>

            <a href="checkoutPage.html" style="margin-top: 14px">
              <button class="checkout-btn" type="button">
                Proceed to checkout
              </button>
            </a>

            <div class="secure" aria-hidden="true">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                style="opacity: 0.9; transform: translateY(1px)"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 1C9.24 1 7 3.24 7 6v3H6a2 2 0 00-2 2v7c0 1.1.9 2 2 2h12a2 2 0 002-2v-7a2 2 0 00-2-2h-1V6c0-2.76-2.24-5-5-5z"
                  stroke="currentColor"
                  stroke-width="1.1"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>Secure checkout · SSL encrypted</span>
            </div>
          </div>
        </aside>
      </main>
    </div>
    <!-- Footer -->
    <div id="footer"></div>
    <script type="module" src="./imports.js"></script>

    <script>
      /********************************************************/

      // Fetch Cart Products
      const addedProducts = JSON.parse(localStorage.getItem("cart"));

      /********************************************************/

      // Display Cart Products
      const displayProductsSection = document.querySelector(
        ".cart-items .panel .cart-products"
      );
      document.addEventListener("DOMContentLoaded", () => {
        addedProducts.map((item) => {
          const product = document.createElement("div");
          product.innerHTML = `
            <article class="item" data-cart-index="${item.id}" aria-labelledby="prod-3">
              <div class="item-img">
                <img
                    src="${item.image}"
                    alt="${item.title}"
                  />
                </div>
                <div class="item-body">
                  <div>
                    <div id="prod-3" class="item-title">
                      ${item.title}
                    </div>
                    <div class="item-meta">
                     Rate: ${item.rating.rate} · Category: ${item.category} ·
                      <span class="item-price">$${item.price}</span>
                    </div>
                  </div>
                  <div class="item-actions">
                    <div class="qty"><img src="../assets/icons/decrease.svg" class="decrease" alt="Subtract">
                      <span class="product-count">${item.quantity}</span>
                      <img src="../assets/icons/add.svg" class="increase" alt="Add"></div>
                    <span class="remove"
                      >Remove</
                    >
                  </div>
                </div>
              </article>
          `;
          displayProductsSection.appendChild(product);
        });
      });

      /********************************************************/

      // Total Products
      const totalCartItems = document.querySelector(".cart-count");
      totalCartItems.innerHTML = `${addedProducts.length} items`;

      

      /********************************************************/

      // Updating Items Quantity
      const container = document.querySelector(".container");

      // Increase / Decrease / Remove
      container.addEventListener("click", (e) => {
        const increase = e.target.closest(".increase");
        const decrease = e.target.closest(".decrease");
        const remove = e.target.closest(".remove");
        const article = e.target.closest("[data-cart-index]");

        if (!article) return;

        const indexAttr = Number(article.dataset.cartIndex);
        const itemIndex = addedProducts.findIndex((e) => e.id === indexAttr);
        if (itemIndex === -1) return;

        if (increase) {
          addedProducts[itemIndex].quantity++;
        } else if (decrease) {
          addedProducts[itemIndex].quantity--;
          if (addedProducts[itemIndex].quantity === 0) {
            addedProducts.splice(itemIndex, 1);
          }
        } else if (remove) {
          addedProducts.splice(itemIndex, 1);
        }
        console.log(addedProducts);
        updateCart(addedProducts);
      });

      /********************************************************/

      function updateCart(param) {
        localStorage.setItem("cart", JSON.stringify(param));
        window.location.reload();
      }

      /********************************************************/

      // Order Summary

      function calculateOrderSummary() {
        const subTotalContainer = document.querySelector(".sub-total");
        const shippingContainer = document.querySelector(".shipping");
        const totalContainer = document.querySelector(".total");
        const taxContainer = document.querySelector(".tax");
        console.log(addedProducts);

        // Sub-Total
        let subTotal = 0;
        addedProducts.forEach((product) => {
          subTotal += product.quantity * product.price;
          console.log(subTotal);
        });
        console.log(subTotal);
        subTotalContainer.innerHTML = `$${subTotal.toFixed(2)}`;
        localStorage.setItem("SubTotal", subTotal.toFixed(2));
        if (subTotal === 0) return;

        // Shipping
        let shipping = subTotal < 99 ? 5 : 0;
        shippingContainer.innerHTML = `$${shipping.toFixed(2)}`;
        taxContainer.innerHTML = `$0.90 `;

        // Total
        let total = subTotal + shipping + 0.9;
        totalContainer.innerHTML = `$${total.toFixed(2)}`;
      }

      calculateOrderSummary();

      /********************************************************/

      // Promo Code
      const promoCode = document.querySelector(".promo-code");
      const coupon = document.querySelector("#coupon");

      promoCode.addEventListener("click", () => {
        if (coupon.value.length < 6) {
          alert("Enter Valid Promo Code!");
        } else {
          alert("Promo Code Not Found!");
        }
      });

      /********************************************************/
    </script>
  </body>
</html>
